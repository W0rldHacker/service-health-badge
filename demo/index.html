<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>service-health-badge — demo</title>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }
      :root {
        font:
          14px/1.45 system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          sans-serif;

        --bg: #ffffff;
        --fg: #111827;
        --muted: #6b7280;
        --surface: #f8fafc;
        --border: #e5e7eb;
        --ctrl-bg: #ffffff;
        --ctrl-border: #d1d5db;
        --primary-bg: #111827;
        --primary-fg: #ffffff;
        --primary-border: #111827;
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0b1220;
          --fg: #e5e7eb;
          --muted: #9ca3af;
          --surface: #111827;
          --border: #374151;
          --ctrl-bg: #111827;
          --ctrl-border: #374151;
          --primary-bg: #2563eb;
          --primary-fg: #ffffff;
          --primary-border: #2563eb;
        }
      }
      /* Ручные переопределения */
      html[data-theme='light'] {
        --bg: #ffffff;
        --fg: #111827;
        --muted: #6b7280;
        --surface: #f8fafc;
        --border: #e5e7eb;
        --ctrl-bg: #ffffff;
        --ctrl-border: #d1d5db;
        --primary-bg: #111827;
        --primary-fg: #fff;
        --primary-border: #111827;
      }
      html[data-theme='dark'] {
        --bg: #0b1220;
        --fg: #e5e7eb;
        --muted: #9ca3af;
        --surface: #111827;
        --border: #374151;
        --ctrl-bg: #111827;
        --ctrl-border: #374151;
        --primary-bg: #2563eb;
        --primary-fg: #fff;
        --primary-border: #2563eb;
      }

      body {
        margin: 24px;
        color: var(--fg);
        background: var(--bg);
      }
      h1 {
        font-size: 18px;
        margin: 0;
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 0 0 16px;
        gap: 12px;
      }
      .inline {
        display: inline-flex;
        gap: 8px;
        align-items: center;
      }
      .muted {
        color: var(--muted);
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      fieldset {
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 16px;
      }
      legend {
        padding: 0 6px;
        color: var(--muted);
      }
      .row {
        display: grid;
        grid-template-columns: 180px 1fr;
        gap: 8px 12px;
        align-items: center;
        margin-bottom: 8px;
      }
      .row > label {
        justify-self: end;
      }
      .row--top {
        align-items: start;
      }
      .row--help > *:first-child {
        visibility: hidden;
      }

      label {
        font-weight: 500;
      }

      input[type='text'],
      input[type='number'],
      textarea,
      select {
        width: 100%;
        max-width: 100%;
        padding: 6px 8px;
        border: 1px solid var(--ctrl-border);
        border-radius: 6px;
        font: inherit;
        background: var(--ctrl-bg);
        color: var(--fg);
      }
      textarea {
        min-height: 72px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        resize: vertical;
      }

      input:focus-visible,
      select:focus-visible,
      textarea:focus-visible,
      button:focus-visible {
        outline: 2px solid #3b82f6;
        outline-offset: 1px;
      }

      .btns {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      button {
        padding: 6px 10px;
        border: 1px solid var(--ctrl-border);
        border-radius: 8px;
        background: var(--ctrl-bg);
        color: var(--fg);
        cursor: pointer;
        transition:
          box-shadow 0.15s ease,
          transform 0.05s ease;
      }
      button:hover {
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.04);
      }
      button:active {
        transform: translateY(1px);
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .btn-primary {
        background: var(--primary-bg);
        color: var(--primary-fg);
        border-color: var(--primary-border);
      }

      #log {
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 8px;
        background: var(--surface);
        max-height: 220px;
        overflow: auto;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 12px;
      }

      @media (max-width: 640px) {
        .row {
          grid-template-columns: 1fr;
          align-items: stretch;
        }
        .row > label {
          justify-self: start;
        }
      }
    </style>

    <script type="module" src="/dist/service-health-badge.js"></script>
    <script type="module" src="./main.js"></script>
  </head>
  <body>
    <div class="topbar">
      <h1>service-health-badge — демо</h1>
      <label class="inline" for="theme">
        <span class="muted">Тема</span>
        <select id="theme" name="theme">
          <option value="auto">Авто</option>
          <option value="light">Светлая</option>
          <option value="dark">Тёмная</option>
        </select>
      </label>
    </div>

    <fieldset>
      <legend>Компонент</legend>
      <div class="row">
        <label for="endpoint">Endpoint</label>
        <input
          id="endpoint"
          name="endpoint"
          type="text"
          inputmode="url"
          value="http://localhost:8080/health?status=ok&latency=50"
          spellcheck="false"
        />
      </div>
      <div class="row">
        <label for="variant">Variant</label>
        <select id="variant" name="variant">
          <option value="dot">dot</option>
          <option value="chip">chip</option>
          <option value="badge" selected>badge</option>
        </select>
      </div>
      <div class="row">
        <label for="interval">Interval (ms)</label>
        <input
          id="interval"
          name="interval"
          type="number"
          value="10000"
          min="100"
          step="100"
          inputmode="numeric"
        />
      </div>
      <div class="row">
        <label for="timeout">Timeout (ms)</label>
        <input
          id="timeout"
          name="timeout"
          type="number"
          value="3000"
          min="100"
          step="100"
          inputmode="numeric"
        />
      </div>
      <div class="row">
        <label for="threshold">Degraded ≥ (ms)</label>
        <input
          id="threshold"
          name="threshold"
          type="number"
          value="0"
          min="0"
          step="50"
          inputmode="numeric"
        />
      </div>
      <div class="row row--top">
        <label for="labels">Labels (JSON)</label>
        <textarea id="labels" name="labels" spellcheck="false" aria-describedby="labelsHelp">
{"ok":"OK","degraded":"Медленно","down":"Недоступен","unknown":"—","offline":"Нет сети"}
      </textarea
        >
      </div>
      <div class="row row--help" aria-hidden="true">
        <div></div>
        <div id="labelsHelp" class="muted">
          Ключи: <code>ok</code>, <code>degraded</code>, <code>down</code>, <code>unknown</code>,
          <code>offline</code>.
        </div>
      </div>
      <div class="row">
        <label for="showLatency">Показывать задержку</label>
        <div class="inline">
          <input
            id="showLatency"
            name="showLatency"
            type="checkbox"
            checked
            aria-describedby="latencyNote"
          />
          <span id="latencyNote" class="muted">(только для варианта «badge»)</span>
        </div>
      </div>
      <div class="btns">
        <button id="apply" class="btn-primary" type="button">Применить</button>
        <button id="refresh" type="button">Опросить сейчас</button>
        <button id="clear" type="button">Очистить лог</button>
      </div>
    </fieldset>

    <fieldset>
      <legend>Источник данных</legend>
      <div class="row">
        <label for="mode">Режим</label>
        <select id="mode" name="mode" aria-describedby="serverHelpText">
          <option value="server">Mock-сервер</option>
          <option value="stub">Fetch-стаб (локально)</option>
        </select>
      </div>
      <div id="serverHelp" class="row row--help">
        <div></div>
        <div id="serverHelpText" class="muted">
          Пример: <code>?status=ok|degraded|down&latency=NN</code> на <code>/health</code>. Запуск:
          <code>npm run mock</code>.
        </div>
      </div>
      <div id="stubControls">
        <div class="row">
          <label for="stubStatus">Статус</label>
          <select id="stubStatus" name="stubStatus">
            <option value="ok">ok</option>
            <option value="degraded">degraded</option>
            <option value="down">down (HTTP 500)</option>
          </select>
        </div>
        <div class="row">
          <label for="stubLatency">Latency (ms)</label>
          <input
            id="stubLatency"
            name="stubLatency"
            type="number"
            value="80"
            min="0"
            step="10"
            inputmode="numeric"
          />
        </div>
        <div class="btns">
          <button id="stubOn" type="button">Включить fetch-стаб</button>
          <button id="stubOff" type="button">Выключить fetch-стаб</button>
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Просмотр</legend>
      <div class="inline" style="gap: 16px; align-items: flex-start">
        <service-health-badge
          id="hb"
          variant="badge"
          aria-label="Состояние сервиса"
          role="status"
        ></service-health-badge>
        <div style="min-width: 320px">
          <div class="muted" style="margin-bottom: 6px">События</div>
          <div id="log" role="log" aria-live="polite" aria-atomic="false" tabindex="0"></div>
        </div>
      </div>
    </fieldset>

    <noscript><p class="muted">Для работы демо нужен JavaScript.</p></noscript>

    <script>
      (function () {
        const html = document.documentElement;
        const select = document.getElementById('theme');
        const saved = localStorage.getItem('shb-theme') || 'auto';

        function applyTheme(v) {
          if (v === 'auto') {
            html.removeAttribute('data-theme');
            localStorage.removeItem('shb-theme');
          } else {
            html.setAttribute('data-theme', v);
            localStorage.setItem('shb-theme', v);
          }
        }
        select.value = saved;
        applyTheme(saved);
        select.addEventListener('change', () => applyTheme(select.value));
      })();

      (function () {
        const variant = document.getElementById('variant');
        const showLatency = document.getElementById('showLatency');
        const mode = document.getElementById('mode');
        const stubControls = document.getElementById('stubControls');
        const serverHelp = document.getElementById('serverHelp');

        function syncLatencyCheckbox() {
          const isBadge = variant.value === 'badge';
          showLatency.disabled = !isBadge;
          showLatency.setAttribute('aria-disabled', String(!isBadge));
        }
        function syncModeVisibility() {
          const isStub = mode.value === 'stub';
          stubControls.hidden = !isStub;
          serverHelp.hidden = isStub;
        }
        variant.addEventListener('change', syncLatencyCheckbox);
        mode.addEventListener('change', syncModeVisibility);
        syncLatencyCheckbox();
        syncModeVisibility();
      })();
    </script>
  </body>
</html>
